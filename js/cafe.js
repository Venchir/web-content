jQuery.fn.redraw=function(){return this.map((function(){return this.offsetTop,this}))};var Cafe={canPay:!1,modeOrder:!1,totalPrice:0,init:function(e){if(Telegram.WebApp.ready(),Cafe.apiUrl=e.apiUrl,Cafe.mode=e.mode,Cafe.userId=e.userId,Cafe.userHash=e.userHash,Cafe.initLotties(),$("body").show(),!(Telegram.WebApp.initDataUnsafe&&Telegram.WebApp.initDataUnsafe.query_id||"inline"==Cafe.mode||"link"==Cafe.mode))return Cafe.isClosed=!0,$("body").addClass("closed"),void Cafe.showStatus("Cafe is temporarily closed");$(".js-item-lottie").on("click",Cafe.eLottieClicked),$(".js-item-incr-btn").on("click",Cafe.eIncrClicked),$(".js-item-decr-btn").on("click",Cafe.eDecrClicked),$(".js-order-edit").on("click",Cafe.eEditClicked),$(".js-status").on("click",Cafe.eStatusClicked),$(".js-order-comment-field").each((function(){autosize(this)})),Telegram.WebApp.MainButton.setParams({text_color:"#fff"}).onClick(Cafe.mainBtnClicked),Telegram.WebApp.BackButton.onClick(Cafe.backBtnClicked),Telegram.WebApp.setHeaderColor("bg_color"),initRipple()},initLotties:function(){$(".js-item-lottie").each((function(){RLottie.init(this,{maxDeviceRatio:2,cachingModulo:3,noAutoPlay:!0})}))},eLottieClicked:function(e){if(Cafe.isClosed)return!1;RLottie.playOnce(this)},eIncrClicked:function(e){e.preventDefault(),Telegram.WebApp.HapticFeedback.impactOccurred("light");var t=$(this).parents(".js-item");Cafe.incrClicked(t,1)},eDecrClicked:function(e){e.preventDefault(),Telegram.WebApp.HapticFeedback.impactOccurred("light");var t=$(this).parents(".js-item");Cafe.incrClicked(t,-1)},eEditClicked:function(e){e.preventDefault(),Cafe.toggleMode(!1)},backBtnClicked:function(){Cafe.toggleMode(!1),document.activeElement&&document.activeElement.blur()},getOrderItem:function(e){var t=e.data("item-id");return $(".js-order-item").filter((function(){return $(this).data("item-id")==t}))},updateItem:function(e,t){var n=+e.data("item-price"),o=+e.data("item-count")||0,i=$(".js-item-counter",e);i.text(o||1);var a=e.hasClass("selected");!a&&o>0&&$(".js-item-lottie",e).each((function(){RLottie.playOnce(this)}));var r=a?t>0?"badge-incr":o>0?"badge-decr":"badge-hide":"badge-show",s=i.css("animation-name");"badge-incr"!=r&&"badge-decr"!=r||r!=s||(r+="2"),i.css("animation-name",r),e.toggleClass("selected",o>0);var d=Cafe.getOrderItem(e);$(".js-order-item-counter",d).text(o||1),d.toggleClass("selected",o>0);var c=o*n;$(".js-order-item-price",d).text(Cafe.formatPrice(c)),Cafe.updateTotalPrice()},incrClicked:function(e,t){if(Cafe.isLoading||Cafe.isClosed)return!1;var n=+e.data("item-count")||0;(n+=t)<0&&(n=0),e.data("item-count",n),Cafe.updateItem(e,t)},formatPrice:function(e){return"$"+Cafe.formatNumber(e/1e3,2,".",",")},formatNumber:function(e,t,n,o){e=(e+"").replace(/[^0-9+\-Ee.]/g,"");var i=isFinite(+e)?+e:0,a=isFinite(+t)?Math.abs(t):0,r=void 0===o?",":o,s=void 0===n?".":n,d="";return d=(a?function(e,t){if(-1===(""+e).indexOf("e"))return+(Math.round(e+"e+"+t)+"e-"+t);var n=(""+e).split("e"),o="";return+n[1]+t>0&&(o="+"),(+(Math.round(+n[0]+"e"+o+(+n[1]+t))+"e-"+t)).toFixed(t)}(i,a).toString():""+Math.round(i)).split("."),d[0].length>3&&(d[0]=d[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,r)),(d[1]||"").length<a&&(d[1]=d[1]||"",d[1]+=new Array(a-d[1].length+1).join("0")),d.join(s)},updateBackgroundColor:function(){var e=parseColorToHex(window.getComputedStyle(document.body).backgroundColor||"#fff");Telegram.WebApp.setBackgroundColor(e)},updateMainButton:function(){var e=Telegram.WebApp.MainButton;Cafe.modeOrder?Cafe.isLoading?e.setParams({is_visible:!0,color:"#65c36d"}).showProgress():e.setParams({is_visible:!!Cafe.canPay,text:"inline"==Cafe.mode?"CREATE ORDER":"link"==Cafe.mode?"CHOOSE A CHATâ€¦":"PAY "+Cafe.formatPrice(Cafe.totalPrice),color:"#31b545"}).hideProgress():e.setParams({is_visible:!!Cafe.canPay,text:"VIEW ORDER",color:"#31b545"}).hideProgress(),Telegram.WebApp.isClosingConfirmationEnabled=!!Cafe.canPay},updateTotalPrice:function(){var e=0;$(".js-item").each((function(){var t=$(this),n=+t.data("item-price"),o=+t.data("item-count")||0;e+=n*o})),Cafe.canPay=e>0,Cafe.totalPrice=e,Cafe.updateMainButton()},getOrderData:function(){var e=[];return $(".js-item").each((function(){var t=$(this),n=t.data("item-id"),o=+t.data("item-count")||0;o>0&&e.push({id:n,count:o})})),JSON.stringify(e)},toggleMode:function(e){var t,n;Cafe.modeOrder=e;try{t=window.getComputedStyle(document.body).getPropertyValue("--page-animation-duration"),(n=/([\d\.]+)(ms|s)/.exec(t))?(t=+n[1],"s"==n[2]&&(t*=1e3)):t=400}catch(e){t=400}if(e){var o=$(".cafe-items").height();$(".js-item-lottie").each((function(){RLottie.pause(this)})),$(".cafe-order-overview").show(),$(".cafe-items").css("maxHeight",o).redraw(),$("body").addClass("order-mode"),$(".js-order-comment-field").each((function(){autosize.update(this)})),Telegram.WebApp.expand(),Telegram.WebApp.BackButton.show()}else $(".js-item-lottie").each((function(){RLottie.reset(this)})),$("body").removeClass("order-mode"),setTimeout((function(){$(".cafe-items").css("maxHeight",""),$(".cafe-order-overview").hide(),$(".js-item-lottie").each((function(){}))}),t),Telegram.WebApp.BackButton.hide();Cafe.updateBackgroundColor(),Cafe.updateMainButton()},toggleLoading:function(e){Cafe.isLoading=e,Cafe.updateMainButton(),$("body").toggleClass("loading",!!Cafe.isLoading),Cafe.updateTotalPrice()},mainBtnClicked:function(){if(!Cafe.canPay||Cafe.isLoading||Cafe.isClosed)return!1;if(Cafe.modeOrder){var e=$(".js-order-comment-field").val(),t={order_data:Cafe.getOrderData(),comment:e};Cafe.mode&&(t.mode=Cafe.mode),Cafe.userId&&Cafe.userHash&&(t.user_id=Cafe.userId,t.user_hash=Cafe.userHash);var n=Telegram.WebApp.isVersionAtLeast("6.1");n&&(t.invoice=1),Cafe.toggleLoading(!0),Cafe.apiRequest("makeOrder",t,(function(e){Cafe.toggleLoading(!1),e.ok&&("inline"==Cafe.mode?Telegram.WebApp.switchInlineQuery("#"+e.order_id):"link"==Cafe.mode?Telegram.WebApp.switchInlineQuery("#"+e.order_id,["users","groups"]):n?Telegram.WebApp.openInvoice(e.invoice_url,(function(e){"paid"==e?Telegram.WebApp.close():"failed"==e?(Telegram.WebApp.HapticFeedback.notificationOccurred("error"),Cafe.showStatus("Payment has been failed.")):(Telegram.WebApp.HapticFeedback.notificationOccurred("warning"),Cafe.showStatus("You have cancelled this order."))})):Telegram.WebApp.close()),e.error&&(Telegram.WebApp.HapticFeedback.notificationOccurred("error"),Cafe.showStatus(e.error))}))}else Cafe.toggleMode(!0)},eStatusClicked:function(){Cafe.hideStatus()},showStatus:function(e){clearTimeout(Cafe.statusTo),$(".js-status").text(e).addClass("shown"),Cafe.isClosed||(Cafe.statusTo=setTimeout((function(){Cafe.hideStatus()}),2500))},hideStatus:function(){clearTimeout(Cafe.statusTo),$(".js-status").removeClass("shown")},apiRequest:function(e,t,n){var o=Telegram.WebApp.initData||"";$.ajax(Cafe.apiUrl,{type:"POST",data:$.extend(t,{_auth:o,method:e}),dataType:"json",xhrFields:{withCredentials:!0},success:function(e){n&&n(e)},error:function(e){n&&n({error:"Server error"})}})}};function parseColorToHex(e){var t;if(t=/^\s*#([0-9a-f]{6})\s*$/i.exec(e+=""))return"#"+t[1].toLowerCase();if(t=/^\s*#([0-9a-f])([0-9a-f])([0-9a-f])\s*$/i.exec(e))return("#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]).toLowerCase();if(t=/^\s*rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+\.{0,1}\d*))?\)\s*$/.exec(e)){var n=parseInt(t[1]),o=parseInt(t[2]),i=parseInt(t[3]);return"#"+(n=(n<16?"0":"")+n.toString(16))+(o=(o<16?"0":"")+o.toString(16))+(i=(i<16?"0":"")+i.toString(16))}return!1}
/*!
  Autosize 3.0.20
  license: MIT
  http://www.jacklmoore.com/autosize
*/function initRipple(){if(document.querySelectorAll)for(var e=document.querySelectorAll(".ripple-handler"),t=function(e){e.offsetTop},n=("ontouchstart"in window),o=0;o<e.length;o++)!function(e){function o(o){var i=e.querySelector(".ripple-mask");if(i){var a=i.getBoundingClientRect();if("touchstart"==o.type)var r=o.targetTouches[0].clientX,s=o.targetTouches[0].clientY;else r=o.clientX,s=o.clientY;var d=r-a.left-i.offsetWidth/2,c=s-a.top-i.offsetHeight/2,l=e.querySelector(".ripple");l.style.transition="none",t(l),l.style.transform="translate3d("+d+"px, "+c+"px, 0) scale3d(0.2, 0.2, 1)",l.style.opacity=1,t(l),l.style.transform="translate3d("+d+"px, "+c+"px, 0) scale3d(1, 1, 1)",l.style.transition="",n?(document.addEventListener("touchend",u),document.addEventListener("touchcancel",u)):document.addEventListener("mouseup",u)}function u(e){l.style.transitionDuration="var(--ripple-end-duration, .2s)",l.style.opacity=0,n?(document.removeEventListener("touchend",u),document.removeEventListener("touchcancel",u)):document.removeEventListener("mouseup",u)}}n?(e.removeEventListener("touchstart",o),e.addEventListener("touchstart",o)):(e.removeEventListener("mousedown",o),e.addEventListener("mousedown",o))}(e[o])}!function(e,t){if("function"==typeof define&&define.amd)define(["exports","module"],t);else if("undefined"!=typeof exports&&"undefined"!=typeof module)t(exports,module);else{var n={exports:{}};t(n.exports,n),e.autosize=n.exports}}(this,(function(e,t){"use strict";function n(e){function t(t){var n=e.style.width;e.style.width="0px",e.offsetWidth,e.style.width=n,e.style.overflowY=t}function n(){var t=e.style.height,n=function(e){for(var t=[];e&&e.parentNode&&e.parentNode instanceof Element;)e.parentNode.scrollTop&&t.push({node:e.parentNode,scrollTop:e.parentNode.scrollTop}),e=e.parentNode;return t}(e),o=document.documentElement&&document.documentElement.scrollTop;e.style.height="auto";var a=e.scrollHeight+i;return 0===e.scrollHeight?void(e.style.height=t):(e.style.height=a+"px",s=e.clientWidth,n.forEach((function(e){e.node.scrollTop=e.scrollTop})),void(o&&(document.documentElement.scrollTop=o)))}function o(){n();var o=Math.round(parseFloat(e.style.height)),i=window.getComputedStyle(e,null),a=Math.round(parseFloat(i.height));if(a!==o?"visible"!==i.overflowY&&(t("visible"),n(),a=Math.round(parseFloat(window.getComputedStyle(e,null).height))):"hidden"!==i.overflowY&&(t("hidden"),n(),a=Math.round(parseFloat(window.getComputedStyle(e,null).height))),d!==a){d=a;var s=r("autosize:resized");try{e.dispatchEvent(s)}catch(e){}}}if(e&&e.nodeName&&"TEXTAREA"===e.nodeName&&!a.has(e)){var i=null,s=e.clientWidth,d=null,c=function(){e.clientWidth!==s&&o()},l=function(t){window.removeEventListener("resize",c,!1),e.removeEventListener("input",o,!1),e.removeEventListener("keyup",o,!1),e.removeEventListener("autosize:destroy",l,!1),e.removeEventListener("autosize:update",o,!1),Object.keys(t).forEach((function(n){e.style[n]=t[n]})),a.delete(e)}.bind(e,{height:e.style.height,resize:e.style.resize,overflowY:e.style.overflowY,overflowX:e.style.overflowX,wordWrap:e.style.wordWrap});e.addEventListener("autosize:destroy",l,!1),"onpropertychange"in e&&"oninput"in e&&e.addEventListener("keyup",o,!1),window.addEventListener("resize",c,!1),e.addEventListener("input",o,!1),e.addEventListener("autosize:update",o,!1),e.style.overflowX="hidden",e.style.wordWrap="break-word",a.set(e,{destroy:l,update:o}),function(){var t=window.getComputedStyle(e,null);"vertical"===t.resize?e.style.resize="none":"both"===t.resize&&(e.style.resize="horizontal"),i="content-box"===t.boxSizing?-(parseFloat(t.paddingTop)+parseFloat(t.paddingBottom)):parseFloat(t.borderTopWidth)+parseFloat(t.borderBottomWidth),isNaN(i)&&(i=0),o()}()}}function o(e){var t=a.get(e);t&&t.destroy()}function i(e){var t=a.get(e);t&&t.update()}var a="function"==typeof Map?new Map:function(){var e=[],t=[];return{has:function(t){return e.indexOf(t)>-1},get:function(n){return t[e.indexOf(n)]},set:function(n,o){-1===e.indexOf(n)&&(e.push(n),t.push(o))},delete:function(n){var o=e.indexOf(n);o>-1&&(e.splice(o,1),t.splice(o,1))}}}(),r=function(e){return new Event(e,{bubbles:!0})};try{new Event("test")}catch(e){r=function(e){var t=document.createEvent("Event");return t.initEvent(e,!0,!1),t}}var s=null;"undefined"==typeof window||"function"!=typeof window.getComputedStyle?(s=function(e){return e},s.destroy=function(e){return e},s.update=function(e){return e}):(s=function(e,t){return e&&Array.prototype.forEach.call(e.length?e:[e],(function(e){return n(e)})),e},s.destroy=function(e){return e&&Array.prototype.forEach.call(e.length?e:[e],o),e},s.update=function(e){return e&&Array.prototype.forEach.call(e.length?e:[e],i),e}),t.exports=s}));